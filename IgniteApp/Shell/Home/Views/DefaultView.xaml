<UserControl
    x:Class="IgniteApp.Shell.Home.Views.DefaultView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conver="clr-namespace:IgniteApp.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:IgniteApp.Shell.Home.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:s="https://github.com/canton7/Stylet"
    xmlns:viewModel="clr-namespace:IgniteApp.Shell.Home.ViewModels"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../../../Assets/Styles/BackgroundBrushStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <conver:StringToImageSourceConverter x:Key="ImageURIConverter" />

            <ContextMenu
                x:Key="ImageContextMenu"
                Background="{x:Null}" DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}"
                Foreground="White">
                <MenuItem
                    Width="120"
                    Background="WhiteSmoke"
                    Command="{Binding SaveImageCommand}"
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=ContextMenu}, Path=PlacementTarget.Source}"
                    Header="保存图片"
                    TextBlock.TextAlignment="Left" />
                <MenuItem
                    Width="120"
                    Background="WhiteSmoke"
                    Command="{Binding GetImageInfoCommand}"
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=ContextMenu}, Path=PlacementTarget.Source}"
                    Header="获取图片信息"
                    TextBlock.TextAlignment="Left" />
            </ContextMenu>
            <DataTemplate x:Key="ProductTemplate">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Border BorderThickness="1">
                        <TextBlock
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Text="{Binding Path=Id}" />
                    </Border>
                    <Border Grid.Column="1" BorderThickness="1">
                        <TextBlock
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Text="{Binding Path=ProductName}" />
                    </Border>

                    <Border Grid.Column="2">
                        <TextBlock
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Text="{Binding Path=Remark}" />
                    </Border>
                </Grid>
            </DataTemplate>
            <Style x:Key="myListBoxItemStyle" TargetType="ListBoxItem">
                <Setter Property="MinHeight" Value="40" />

                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ListBoxItem}">
                            <Grid>
                                <Border x:Name="borderHeader" />
                                <Border x:Name="border" />
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="borderHeader" Property="BorderThickness" Value="4,0,0,0" />
                                    <Setter TargetName="border" Property="Opacity" Value="0.2" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="Gray" />
                                    <Setter TargetName="border" Property="Opacity" Value="0.2" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="False">
                                    <Setter TargetName="borderHeader" Property="BorderThickness" Value="0,0,0,0" />
                                    <Setter TargetName="border" Property="Background" Value="White" />
                                    <Setter TargetName="border" Property="Opacity" Value="0.2" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="auto" />
            <RowDefinition Height="260" />
        </Grid.RowDefinitions>

        <UniformGrid Columns="3" Rows="2">
            <Image Tag="{Binding ImageContextMenuViewModel}" ContextMenu="{StaticResource ImageContextMenu}" Source="{Binding ImageURI, Converter={StaticResource ImageURIConverter}}" />
            <Image Tag="{Binding ImageContextMenuViewModel}" ContextMenu="{StaticResource ImageContextMenu}" Source="{Binding ImageURI, Converter={StaticResource ImageURIConverter}}" />
            <Image Tag="{Binding ImageContextMenuViewModel}" ContextMenu="{StaticResource ImageContextMenu}" Source="{Binding ImageURI, Converter={StaticResource ImageURIConverter}}" />
            <Image Tag="{Binding ImageContextMenuViewModel}" ContextMenu="{StaticResource ImageContextMenu}" Source="{Binding ImageURI, Converter={StaticResource ImageURIConverter}}" />
            <Image Tag="{Binding ImageContextMenuViewModel}" ContextMenu="{StaticResource ImageContextMenu}" Source="{Binding ImageURI, Converter={StaticResource ImageURIConverter}}" />
            <Image Tag="{Binding ImageContextMenuViewModel}" ContextMenu="{StaticResource ImageContextMenu}" Source="{Binding ImageURI, Converter={StaticResource ImageURIConverter}}" />
        </UniformGrid>
        <Grid Grid.Row="1">
            <StackPanel Orientation="Horizontal">
                <Polygon
                    Fill="#FFB3E0FF"
                    Points="0,0 100,0 120,20 100,40 0,40"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF7AC5FF"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF00BFFF"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF009CE7"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF7AC5FF"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF00BFFF"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF009CE7"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF7AC5FF"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF00BFFF"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF009CE7"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
                <Polygon
                    Fill="#FF0078D7"
                    Points="-20,0 100,0 120,20 100,40 -20,40 0,20"
                    StrokeThickness="1" />
            </StackPanel>
            <StackPanel Panel.ZIndex="1" Orientation="Horizontal">
                <TextBlock
                    Width="100"
                    Height="30"
                    Padding="30,5"
                    FontSize="15"
                    Text="上料" />
                <TextBlock
                    Width="120"
                    Height="30"
                    Padding="40,5"
                    FontSize="15"
                    Text="电路板制造" />
                <TextBlock
                    Width="120"
                    Height="30"
                    Padding="40,5"
                    FontSize="15"
                    Text="电路板测试" />
                <TextBlock
                    Width="120"
                    Height="30"
                    Padding="40,5"
                    FontSize="15"
                    Text="组装" />
                <TextBlock
                    Width="120"
                    Height="30"
                    Padding="40,5"
                    FontSize="15"
                    Text="装药" />
                <TextBlock
                    Width="120"
                    Height="30"
                    Padding="40,5"
                    FontSize="15"
                    Text="密封" />
                <TextBlock
                    Width="120"
                    Height="30"
                    Padding="40,5"
                    FontSize="15"
                    Text="安全测试" />
                <TextBlock
                    Width="120"
                    Height="30"
                    Padding="40,5"
                    FontSize="15"
                    Text="装箱" />
                <TextBlock
                    Width="120"
                    Height="30"
                    Padding="40,5"
                    FontSize="15"
                    Text="下料" />
            </StackPanel>
        </Grid>

        <hc:TabControl
            Grid.Row="2"
            IsAnimationEnabled="True"
            ShowCloseButton="False"
            ShowScrollButton="True">
            <hc:TabItem Header="当前运行信息" TextBlock.TextAlignment="Center">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>

                    <GroupBox Header="产品信息">
                        <ListBox
                            ItemContainerStyle="{DynamicResource myListBoxItemStyle}"
                            ItemTemplate="{StaticResource ProductTemplate}"
                            ItemsSource="{Binding ProductList}" />
                    </GroupBox>
                    <GroupBox Grid.Column="1" Header="生产信息统计">
                        <Border>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100" />
                                    <ColumnDefinition Width="auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <TextBlock
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Text="OK品：" />
                                <TextBox
                                    Grid.Row="0"
                                    Grid.Column="1"
                                    Height="30"
                                    Text="{Binding StaticticInfo.OkCount, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" />
                                <TextBlock
                                    Grid.Row="1"
                                    Grid.Column="0"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Text="NG品：" />
                                <TextBox
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Height="30"
                                    Text="{Binding StaticticInfo.NgCount, UpdateSourceTrigger=PropertyChanged}" />
                                <TextBlock
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Text="当日产量：" />
                                <TextBox
                                    Grid.Row="2"
                                    Grid.Column="1"
                                    Height="30"
                                    Text="{Binding StaticticInfo.OutputCount, UpdateSourceTrigger=PropertyChanged}" />
                                <Button
                                    Grid.Row="3"
                                    Grid.Column="1"
                                    Width="200"
                                    Command="{s:Action ExecuteReset}"
                                    Content="重置" />
                            </Grid>
                        </Border>
                    </GroupBox>
                </Grid>
            </hc:TabItem>

            <hc:TabItem Header="物料信息" TextBlock.TextAlignment="Center">
                <DataGrid
                    AutoGenerateColumns="False"
                    Background="Transparent"
                    BorderThickness="0"
                    CanUserSortColumns="False"
                    ForceCursor="True"
                    GridLinesVisibility="None"
                    HorizontalGridLinesBrush="Black"
                    IsReadOnly="True"
                    ItemsSource="{Binding MaterialInfoList}"
                    RowDetailsVisibilityMode="Collapsed"
                    SelectionMode="Single"
                    VerticalGridLinesBrush="Black">
                    <DataGrid.Columns>
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding Id}"
                            Header="物料Id" />
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding Station}"
                            Header="当前工位" />
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding Status}"
                            Header="物料状态" />
                        <DataGridTextColumn
                            Width="120"
                            Binding="{Binding CreateTime, StringFormat='yyyy/MM/dd'}"
                            Header="当前时间" />
                        <DataGridTemplateColumn Width="*" Header="操作">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button
                                            Width="70"
                                            Margin="0,0,15,0"
                                            Background="LightGreen"
                                            Command="{Binding DataContext.UpdateCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=DataGrid}}"
                                            CommandParameter="{Binding Id}"
                                            Content="修改"
                                            FontSize="14"
                                            Foreground="Black" />
                                        <Button
                                            Width="70"
                                            Background="Red"
                                            Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=DataGrid}}"
                                            CommandParameter="{Binding Id}"
                                            Content="删除"
                                            FontSize="14"
                                            Foreground="Black" />
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </hc:TabItem>
        </hc:TabControl>
    </Grid>
</UserControl>